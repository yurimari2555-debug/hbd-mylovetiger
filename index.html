<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î ü•≥</title>
<meta name="description" content="‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡∏™‡∏∏‡∏î‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏π‡∏Å‡πÇ‡∏õ‡πà‡∏á ‡πÄ‡∏Ñ‡πâ‡∏Å ‡πÄ‡∏õ‡πà‡∏≤‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô ‡πÅ‡∏•‡∏∞‡πÇ‡∏õ‡∏£‡∏¢‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏ï‡∏ï‡∏µ‡πâ">
<style>
  :root{
    --bg:#0f1226;
    --card:#15193a;
    --card-2:#1b2050;
    --text:#f7f7fb;
    --muted:#b9c1ff;
    --accent:#ffd166;
    --accent-2:#ff6b6b;
    --accent-3:#7bdff2;
    --accent-4:#c3f584;
    --shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: ui-sans-serif, -apple-system, system-ui, "Segoe UI", Roboto, "Noto Sans Thai", "Noto Sans", "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
    overflow-x:hidden;
  }
  /* Intro */
  #intro {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: linear-gradient(135deg, #001f3f, #0074D9, #7FDBFF);
    animation: gradientFlow 12s ease infinite;
    background-size: 400% 400%;
    z-index: 999;
    text-align: center;
    color: white;
  }
  @keyframes gradientFlow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  #intro h1 {
    font-size: 2.3em;
    margin-bottom: 20px;
    text-shadow: 0 0 8px #00c0ff, 0 0 16px #0074D9;
  }
  #intro .cat {
    font-size: 4em;
    animation: bounce 2s infinite, glow 1.5s alternate infinite;
  }
  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-15px); }
  }
  @keyframes glow {
    from { text-shadow: 0 0 5px #fff; }
    to { text-shadow: 0 0 20px #ff9ff3; }
  }
  #intro button {
    margin-top: 25px;
    padding: 12px 30px;
    border: none;
    border-radius: 40px;
    background: linear-gradient(45deg, #ff9ff3, #74b9ff);
    color: white;
    font-weight: bold;
    font-size: 1.3em;
    cursor: pointer;
    box-shadow: 0 0 20px rgba(255,192,203,0.8);
    transition: 0.3s;
  }
  #intro button:hover {
    transform: scale(1.1);
    box-shadow: 0 0 30px #ff9ff3, 0 0 40px #74b9ff;
  }
  /* Main */
  #main{
    display: none;
    text-align: center;
    padding-bottom: 50px;
    background: radial-gradient(1200px 800px at 70% -10%, #2a2f6b22 10%, transparent 60%) , var(--bg);
    color:var(--text);
    position: relative;
    min-height: 100vh;
    overflow: hidden;
  }
  header{
    position:relative;
    padding: clamp(20px, 4vw, 40px);
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:16px;
    text-align:center;
  }
  .badge{
    display:inline-block;
    padding:8px 14px;
    border-radius:999px;
    background:linear-gradient(45deg, #ff9a9e, #fad0c4);
    color:#2b2b2b;
    font-weight:700;
    box-shadow:var(--shadow);
  }
  h1{
    margin:0;
    font-size: clamp(26px, 5vw, 48px);
    line-height:1.1;
    letter-spacing: .5px;
    text-shadow: 0 0 8px #ffb6c1, 0 0 16px #74b9ff;
  }
  .subtitle{
    margin-top:6px;
    color:var(--muted);
    font-size:clamp(14px, 2.5vw, 18px);
  }

  .hero-card{
    position:relative;
    width:min(920px, 92vw);
    margin: 12px auto 24px;
    border-radius:24px;
    padding:24px;
    background: linear-gradient(180deg, var(--card), var(--card-2));
    box-shadow:var(--shadow);
    overflow:hidden;
  }

  .controls{
    display:flex; gap:12px; flex-wrap:wrap; justify-content:center; margin-top:10px;
  }
  button{
    background:#ffffff12;
    color:var(--text);
    border:1px solid #ffffff20;
    padding:10px 16px;
    border-radius:12px;
    cursor:pointer;
    backdrop-filter: blur(6px);
    font-weight:600;
    transition: transform .12s ease, background .2s ease, border-color .2s ease;
  }
  button:hover{ transform: translateY(-1px); background:#ffffff1e; border-color:#ffffff40; }
  button:active{ transform: translateY(1px) scale(.98); }

  /* Floating balloons */
  .balloons{ position:absolute; inset:0; pointer-events:none; overflow:hidden; }
  .balloon{
    position:absolute;
    bottom:-120px;
    width: var(--s, 30px);
    height: calc(var(--s,30px) * 1.25);
    background: radial-gradient(circle at 30% 30%, #fff8, transparent 35%), var(--c,#ff6b6b);
    border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
    box-shadow:0 10px 20px #0004;
    animation: rise var(--t,10s) linear infinite;
    opacity:.9;
  }
  .balloon::after{
    content:"";
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    bottom:-16px;
    width:2px; height:24px;
    background:#ffffff33;
  }
  @keyframes rise {
    from { transform: translateY(0) translateX(0) rotate(0deg); }
    to { transform: translateY(-120vh) translateX(var(--x,0)) rotate(6deg); }
  }

  /* Cake */
  .cake-wrap{ display:flex; flex-direction:column; align-items:center; gap:14px; margin-top:8px;}
  .cake{
    position:relative;
    width:min(500px, 86vw);
    aspect-ratio: 5/3;
    display:grid;
    place-items:end center;
  }
  .plate{
    width:80%;
    height:16%;
    background:linear-gradient(#bcdcff, #8aa6ff);
    border-radius: 50px;
    box-shadow: inset 0 -8px 16px #0003;
  }
  .body1{
    position:absolute; bottom:16%;
    width:64%; height:42%;
    background: linear-gradient(#fff0f0, #ffd7d7);
    border-radius: 16px 16px 10px 10px;
    box-shadow: 0 10px 20px #0004, inset 0 -10px 18px #0002;
  }
  .drip{ position:absolute; bottom: calc(16% + 40%); width:10px; height:16px; background:#ffe1e1; border-radius: 10px; box-shadow:0 6px 0 0 #fbd0d0; }
  .stripe{ position:absolute; bottom:calc(16% + 10%); width:64%; height:12%; background:repeating-linear-gradient(45deg, #ffc0cb 0 16px, #ffd6e8 16px 32px); border-radius:10px; }
  .candle{
    position:absolute; bottom: calc(16% + 42%);
    width:10px; height:40px; background: repeating-linear-gradient(90deg, #ffe2a1 0 6px, #ffd166 6px 12px);
    border-radius: 6px;
    left:50%; transform:translateX(-50%);
  }
  .flame{
    --size: 16px;
    position:absolute; bottom: calc(16% + 42% + 38px);
    left:50%; transform:translateX(-50%);
    width:var(--size); height:calc(var(--size) * 1.3);
    background: radial-gradient(circle at 45% 30%, #fff, #ffd166 60%, #ff7b00 100%);
    border-radius:50% 50% 50% 50%/60% 60% 40% 40%;
    filter: blur(.4px) drop-shadow(0 0 12px #ffcf33);
    animation: flicker .18s infinite alternate;
    transform-origin: bottom center;
  }
  @keyframes flicker{
    from { transform: translateX(-50%) scale(1) rotate(-2deg); }
    to   { transform: translateX(-50%) scale(1.07) rotate(2deg); }
  }

  /* Messages */
  .msg{
    margin:16px auto 0;
    max-width:720px;
    text-align:center;
    color:var(--text);
    font-size: clamp(16px, 2.6vw, 20px);
  }
  .msg .muted{ color:var(--muted); font-size:.95em; }
  .marquee{
    margin-top:12px;
    font-weight:700;
    white-space:nowrap;
    overflow:hidden;
    mask-image: linear-gradient(90deg, transparent, #000 10%, #000 90%, transparent 100%);
  }
  .marquee span{ display:inline-block; padding-right:30px; animation: marquee 16s linear infinite; }
  @keyframes marquee { from{ transform:translateX(0)} to{ transform:translateX(-50%)} }

  /* Gallery uploader */
  section{
    width:min(920px, 92vw);
    margin: 20px auto 60px;
    padding: 18px;
    background: linear-gradient(180deg, var(--card), var(--card-2));
    border-radius: 20px;
    box-shadow: var(--shadow);
  }
  .section-title{ margin:0 0 10px; font-size: clamp(18px, 3.6vw, 22px); color:var(--muted); }
  .uploader{ display:flex; flex-direction:column; gap:10px; align-items:center; }
  .grid{
    display:grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap:10px; margin-top:12px;
  }
  .grid img{
    width:100%; aspect-ratio:1/1; object-fit:cover; border-radius:12px; box-shadow:0 8px 16px #0004;
  }
  .slideshow {
    margin-top: 20px;
    position: relative;
    max-width: 90%;
    margin-left: auto;
    margin-right: auto;
  }
  .slideshow img {
    width: 100%;
    max-width: 700px;
    border-radius: 15px;
    box-shadow: 0 0 15px rgba(255,255,255,0.6);
    display: none;
    cursor: pointer;
    margin: auto;
  }
  .slideshow img.active {
    display: block;
    animation: fade 1s ease-in-out;
  }
  @keyframes fade {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  .prev, .next {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 182, 193, 0.7);
    color: white;
    border: none;
    font-size: 2em;
    padding: 10px 15px;
    cursor: pointer;
    border-radius: 50%;
    transition: 0.3s;
  }
  .prev:hover, .next:hover {
    background: #ff4fac;
  }
  .prev { left: 5%; }
  .next { right: 5%; }

  footer{
    text-align:center; color:#a6afff; padding:30px 10px 60px; font-size:14px;
  }

  /* Confetti canvas sits on top */
  #confetti {
    position: fixed;
    inset:0;
    pointer-events:none;
  }

  /* Dialog */
  dialog{
    border:none; border-radius:16px; padding:18px 16px; max-width:min(520px, 92vw);
    background:linear-gradient(180deg, #20265a, #1b2050);
    color:var(--text);
    box-shadow: var(--shadow);
  }
  dialog::backdrop{ background:#0007; backdrop-filter: blur(2px); }
  .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin:8px 0; }
  input, textarea{
    background:#ffffff10; border:1px solid #ffffff22; color:var(--text);
    border-radius:10px; padding:10px; width:100%;
  }
  label{ font-size:14px; color:var(--muted); }
  .music-control {
    margin: 15px auto;
    padding: 12px 20px;
    border-radius: 50px;
    background: #fff;
    color: #ff4fac;
    font-weight: bold;
    font-size: 1.1em;
    border: 2px solid #ff4fac;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    transition: 0.3s;
  }
  .music-control:hover {
    background: #ff4fac;
    color: white;
    transform: scale(1.1);
  }
  .blow-btn {
    margin-top: 10px;
    padding: 10px 20px;
    border: none;
    border-radius: 25px;
    background: linear-gradient(45deg, #ff9ff3, #74b9ff);
    color: white;
    font-size: 1.1em;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 0 15px rgba(255, 182, 193, 0.7);
    transition: 0.3s;
  }
  .blow-btn:hover {
    transform: scale(1.1);
    background: linear-gradient(45deg, #ff4fac, #4facfe);
  }
  .heart {
    position: fixed;
    bottom: 0;
    font-size: 24px;
    animation: floatUp 6s linear forwards;
    opacity: 0.7;
    pointer-events: none;
  }
  @keyframes floatUp {
    0% { transform: translateY(0); opacity: 1; }
    100% { transform: translateY(-600px); opacity: 0; }
  }
  .star {
    position: absolute;
    width: 2px;
    height: 2px;
    background: white;
    border-radius: 50%;
    opacity: 0.8;
    animation: twinkle 2s infinite alternate;
  }
  @keyframes twinkle {
    from { opacity: 0.2; transform: scale(1); }
    to { opacity: 1; transform: scale(1.6); }
  }

</style>
</head>
<body>
<canvas id="confetti"></canvas>

<div id="intro">
  <h1>‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡πÉ‡∏Ñ‡∏£‡∏ô‡πâ‡∏≤‡∏≤‡∏≤‡∏≤ üéÇ</h1>
  <div class="cat">üê±</div>
  <button onclick="enterSite()">‡πÄ‡∏Ñ‡πâ‡∏≤‡πÄ‡∏≠‡∏á üéâ</button>
</div>

<div id="main">
  <div class="balloons" id="balloons"></div>

  <header>
    <span class="badge">HBD Web</span>
    <h1 id="title">‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î, <span id="name">‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏Å</span> üéâ</h1>
    <div class="subtitle">‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏≠‡∏¢‡∏¢‡∏¥‡πâ‡∏° ‡∏™‡∏°‡∏´‡∏ß‡∏±‡∏á ‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏î‡∏µ ‡πÜ ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì</div>
  </header>

  <div class="hero-card">
    <div class="cake-wrap">
      <div class="cake" aria-label="‡πÄ‡∏Ñ‡πâ‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î">
        <div class="plate"></div>
        <div class="body1"></div>
        <div class="stripe"></div>
        <div class="drip" style="left:34%"></div>
        <div class="drip" style="left:44%"></div>
        <div class="drip" style="left:56%"></div>
        <div class="drip" style="left:66%"></div>
        <div class="candle"></div>
        <div class="flame" id="flame" aria-hidden="false"></div>
      </div>
    </div>
    <div class="controls">
      <button id="blow" class="blow-btn">‡πÄ‡∏õ‡πà‡∏≤‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô üéÇ</button>
      <button id="music" class="music-control">‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏û‡∏•‡∏á ‚ô´</button>
    </div>
  </div>

  <section>
    <h3 class="section-title">‡∏≠‡∏±‡∏•‡∏ö‡∏±‡πâ‡∏°‡∏£‡∏π‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥</h3>
    <div class="slideshow">
      <img src="https://picsum.photos/id/1011/1000/600" class="active" onclick="showWish('üíñ ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏°‡∏≤‡∏Å‡πÜ ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÜ ‡∏ß‡∏±‡∏ô!')">
      <img src="https://picsum.photos/id/1015/1000/600" onclick="showWish('üéÇ ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á ‡∏£‡πà‡∏≥‡∏£‡∏ß‡∏¢‡πÜ ‡πÄ‡∏Æ‡∏á‡πÜ ‡∏ô‡∏∞!')">
      <img src="https://picsum.photos/id/1016/1000/600" onclick="showWish('‚ú® ‡∏™‡∏°‡∏´‡∏ß‡∏±‡∏á‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à!')">

      <button class="prev" onclick="changeSlide(-1)">‚ùÆ</button>
      <button class="next" onclick="changeSlide(1)">‚ùØ</button>
    </div>
  </section>

  <footer>
    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å ‚Ä¢ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ üíù
  </footer>

</div>

<dialog id="editor">
  <form method="dialog">
    <h3 style="margin:0 0 6px">‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß</h3>
    <div class="row">
      <label for="nameInput">‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ü‡∏ô</label>
      <input id="nameInput" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏û‡∏£‡∏ß/‡∏ü‡πâ‡∏≤/‡πÑ‡∏ï‡∏ï‡∏±‡πâ‡∏ô" />
    </div>
    <div class="row">
      <label for="wishInput">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏ß‡∏¢‡∏û‡∏£</label>
      <textarea id="wishInput" rows="3" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô ‡πÜ ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà"></textarea>
    </div>
    <div class="row" style="justify-content:flex-end">
      <button value="cancel">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button id="save" value="default">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </div>
  </form>
</dialog>

<div id="wishPopup" class="wish-box"></div>

<script>
  // ---- Quick personalization (saved in localStorage) ----
  const $ = (q)=>document.querySelector(q);
  const nameEl = $("#name");
  const titleEl = $("#title");
  const wishEl = $("#wish");
  const TICKER_TEXT_DEFAULT = "Happy Birthday ‚Ä¢ ‡∏£‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å ‚Ä¢ ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏´‡∏ß‡∏±‡∏á‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á ‚Ä¢ ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å ‡πÜ ‡∏ß‡∏±‡∏ô ‚Ä¢ ";

  const store = {
    get key(){ return "hbd-config-v1"; },
    load(){
      try{ return JSON.parse(localStorage.getItem(this.key)) || {}; }catch(e){ return {}; }
    },
    save(cfg){
      localStorage.setItem(this.key, JSON.stringify(cfg));
    }
  };

  function applyConfig(cfg){
    if(cfg.name){
      nameEl.textContent = cfg.name;
      document.title = `‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î, ${cfg.name} ü•≥`;
    }
    if(cfg.wish){
      wishEl.innerHTML = cfg.wish;
    }
    // $("#ticker").textContent = cfg.ticker || TICKER_TEXT_DEFAULT;
  }

  // initial
  applyConfig(store.load());

  // ---- Balloons generator ----
  const balloonColors = ["#ff6b6b","#ffd166","#7bdff2","#c3f584","#b088f9","#ff9a9e"];
  const balloonsWrap = $("#balloons");
  function spawnBalloon(){
    const b = document.createElement("div");
    b.className = "balloon";
    const s = 24 + Math.random()*28; // size
    b.style.setProperty("--s", s + "px");
    b.style.left = (Math.random()*100) + "%";
    b.style.setProperty("--t", (10 + Math.random()*10) + "s");
    b.style.setProperty("--c", balloonColors[Math.floor(Math.random()*balloonColors.length)]);
    b.style.setProperty("--x", (Math.random()<0.5?-1:1) * (20 + Math.random()*60) + "px");
    balloonsWrap.appendChild(b);
    // cleanup after animation
    setTimeout(()=>b.remove(), 20000);
  }
  setInterval(spawnBalloon, 800);
  for(let i=0;i<12;i++) setTimeout(spawnBalloon, 120*i);

  // ---- Confetti (simple canvas particles) ----
  const canvas = document.getElementById("confetti");
  const ctx = canvas.getContext("2d");
  let W, H; function resize(){ W=canvas.width=innerWidth; H=canvas.height=innerHeight; } resize(); addEventListener("resize", resize);
  const COLORS = ["#ffd166","#ff6b6b","#7bdff2","#c3f584","#b088f9","#f9f871"];
  let confetti = [];

  function burstConfetti(x=W/2, y=H*0.35, n=120){
    for(let i=0;i<n;i++){
      confetti.push({
        x, y,
        vx: (Math.random()*2-1) * (4 + Math.random()*3),
        vy: (-6 - Math.random()*6),
        g: 0.2 + Math.random()*0.15,
        s: 4 + Math.random()*6,
        r: Math.random()*Math.PI,
        vr: (Math.random()-.5)*0.25,
        c: COLORS[(Math.random()*COLORS.length)|0],
        life: 120 + Math.random()*40
      });
    }
  }

  function drawConfetti(){
    ctx.clearRect(0,0,W,H);
    confetti.forEach(p=>{
      p.vy += p.g;
      p.x += p.vx;
      p.y += p.vy;
      p.r += p.vr;
      p.life -= 1;
      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.r);
      ctx.fillStyle = p.c;
      ctx.fillRect(-p.s/2, -p.s/2, p.s, p.s);
      ctx.restore();
    });
    confetti = confetti.filter(p=> p.life>0 && p.y < H + 30);
    requestAnimationFrame(drawConfetti);
  }
  drawConfetti();

  // ---- Candle blowing ----
  const flame = $("#flame");
  $("#blow").addEventListener("click", ()=>{
    flame.style.display = "none"; // hide flame
    burstConfetti();
    setTimeout(()=>{ flame.style.display = "block"; }, 3200);
  });


  // ---- Tiny music with WebAudio (no external files) ----
  let audioCtx, seqRunning = false;
  function playMelody(){
    if(seqRunning) return;
    const melody = [
      // Simple "HBD" phrase in C major (note, duration in beats)
      ["G4",0.5],["G4",0.5],["A4",1],["G4",1],["C5",1],["B4",2],
      ["G4",0.5],["G4",0.5],["A4",1],["G4",1],["D5",1],["C5",2]
    ];
    const bpm = 120;
    const beat = 60/bpm;

    audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)();
    const now = audioCtx.currentTime + 0.05;
    let t = now;

    function freq(n){ // n like "C4"
      const A4 = 440;
      const NOTES = {"C":-9,"C#":-8,"Db":-8,"D":-7,"D#":-6,"Eb":-6,"E":-5,"F":-4,"F#":-3,"Gb":-3,"G":-2,"G#":-1,"Ab":-1,"A":0,"A#":1,"Bb":1,"B":2};
      const m = n.match(/^([A-G]#?b?)(\d)$/); if(!m) return A4;
      const semis = (parseInt(m[2])-4)*12 + (NOTES[m[1]]||0);
      return A4 * Math.pow(2, semis/12);
    }

    melody.forEach(([note,dur])=>{
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = "sine";
      o.frequency.value = freq(note);
      o.connect(g); g.connect(audioCtx.destination);
      // envelope
      const a = 0.02, d = 0.08, s = 0.65, r = 0.12;
      g.gain.setValueAtTime(0, t);
      g.gain.linearRampToValueAtTime(0.9, t+a);
      g.gain.linearRampToValueAtTime(0.6, t+a+d);
      g.gain.setValueAtTime(0.6, t + beat*dur - r);
      g.gain.linearRampToValueAtTime(0, t + beat*dur);
      o.start(t);
      o.stop(t + beat*dur + 0.02);
      t += beat*dur;
    });

    seqRunning = true;
    setTimeout(()=> seqRunning=false, (t-now)*1000 + 200);
  }

  $("#music").addEventListener("click", playMelody);

  // ---- Editor dialog ----
  const dlg = $("#editor");
  $("#edit").addEventListener("click", ()=>{
    $("#nameInput").value = nameEl.textContent;
    $("#wishInput").value = wishEl.innerHTML;
    dlg.showModal();
  });
  $("#save").addEventListener("click", (e)=>{
    e.preventDefault();
    const cfg = store.load();
    cfg.name = $("#nameInput").value.trim() || "‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏Å";
    cfg.wish = $("#wishInput").value.trim() || wishEl.innerHTML;
    store.save(cfg);
    applyConfig(cfg);
    dlg.close();
  });

  // ---- Share ----
  $("#share").addEventListener("click", async ()=>{
    try{
      const shareData = {
        title: document.title,
        text: "‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏¢!",
        url: location.href
      };
      if(navigator.share){ await navigator.share(shareData); }
      else{
        await navigator.clipboard.writeText(location.href);
        alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß ‡∏ß‡∏≤‡∏á‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏ü‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!");
      }
    }catch(e){ console.log(e); }
  });

  // ---- Gallery uploader ----
  const grid = $("#grid");
  $("#file").addEventListener("change", (e)=>{
    const files = [...e.target.files].slice(0, 36); // limit
    files.forEach(f=>{
      const url = URL.createObjectURL(f);
      const img = new Image();
      img.onload = ()=> URL.revokeObjectURL(url);
      img.src = url;
      grid.appendChild(img);
    });
  });

  // ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤
  function enterSite() {
    document.getElementById("intro").style.display = "none";
    document.getElementById("main").style.display = "block";
    playMelody();
    startEffects();
  }

  // slideshow
  let slideIndex = 0;
  const slides = document.querySelectorAll(".slideshow img");
  function showSlide(n) {
    slides.forEach((slide, i) => {
      slide.classList.remove("active");
      if (i === n) slide.classList.add("active");
    });
  }
  function changeSlide(n) {
    slideIndex = (slideIndex + n + slides.length) % slides.length;
    showSlide(slideIndex);
  }
  setInterval(() => { changeSlide(1); }, 5000);

  // Effects
  function startEffects() {
    // hearts
    setInterval(() => {
      const heart = document.createElement("div");
      heart.className = "heart";
      heart.innerHTML = "‚ù§Ô∏è";
      heart.style.left = Math.random() * 100 + "vw";
      heart.style.fontSize = (Math.random() * 20 + 20) + "px";
      document.body.appendChild(heart);
      setTimeout(() => heart.remove(), 5000);
    }, 1200);

    // stars
    for (let i = 0; i < 40; i++) {
      let star = document.createElement("div");
      star.className = "star";
      star.style.top = Math.random() * window.innerHeight + "px";
      star.style.left = Math.random() * window.innerWidth + "px";
      star.style.animationDuration = (1 + Math.random() * 2) + "s";
      document.getElementById("main").appendChild(star);
    }
  }

</script>
</body>
</html>
